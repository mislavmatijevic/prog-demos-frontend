<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>ProgDemosFrontend</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    #preloader {
      color: white;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 100%;
      font-size: 40px;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>

<body>
  <div id="preloader"></div>
  <app-root></app-root>
</body>

</html>

<script>
  const setupPreloader = () => {
    const preloader = document.getElementById('preloader');
    if (preloader == null) {
      return
    }

    const mockSentences = [
      {
        mockTask: "Povezivanje sa poslužiteljem...       ",
        mockResult: "0%"
      },
      {
        mockTask: "==========",
        mockResult: "=================           100%"
      },
      {
        mockTask: "",
        mockResult: "Povezano!"
      },
      {
        mockTask: "Smišljanje teških zadataka...         ",
        mockResult: "0%"
      },
      {
        mockTask: "=========================",
        mockResult: "==           100%"
      },
      {
        mockTask: "Ruganje lošim rješenjima...           ",
        mockResult: "0%"
      },
      {
        mockTask: "========",
        mockResult: "===================           100%"
      },
      {
        mockTask: "HAHA",
        mockResult: "HAHA"
      },
      {
        mockTask: "Analiza osjećaja nakon ruganja... ",
        mockResult: "OK, sram me."
      },
      {
        mockTask: "Priprema zadataka... ",
        mockResult: "    OK."
      },
      {
        mockTask: "[NOVA PORUKA od prog_demos]: ",
        mockResult: "Bome ti se ovo dugo učitava?"
      },
      {
        mockTask: "Otvaranje aplikacije ",
        mockResult: ""
      }
    ];

    let delayBetweenSentences = 500;

    const displaySentences = async () => {
      for (const sentenceObj of mockSentences) {
        await slowlyDisplaySentence(sentenceObj.mockTask, delayBetweenSentences);
        await slowlyDisplaySentence(sentenceObj.mockResult, delayBetweenSentences);
        preloader.innerText += '\n';
      }
      while (true) {
        await slowlyDisplaySentence(".", delayBetweenSentences);
      }
    }

    const slowlyDisplaySentence = (sentence, delay) => {
      return new Promise(resolve => {
        let sentenceIndex = 0;
        const intervalHandler = setInterval(() => {
          if (sentenceIndex < sentence.length) {
            const currentChar = sentence.charAt(sentenceIndex++);
            preloader.innerText += currentChar === ' ' ? '\u00A0' : currentChar;
          } else {
            clearInterval(intervalHandler);
            preloader.setAttribute("intervalHandler", intervalHandler)
            const timeoutHandlerSentence = setTimeout(resolve, delay);
            preloader.setAttribute("timeoutHandlerSentence", timeoutHandlerSentence)
          }
        }, 10);
        preloader.setAttribute("intervalHandler", intervalHandler)
      });
    }

    const timeoutHandler = setTimeout(() => {
      displaySentences();
    }, 10);
    preloader.setAttribute("timeoutHandler", timeoutHandler)
  }

  setTimeout(() => setupPreloader(), 500);
</script>